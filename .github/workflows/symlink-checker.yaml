---
name: Check test suites structure
on:  # yamllint disable-line rule:truthy
  push:
    branches: [main]
  pull_request:
    branches: [main]
jobs:
  symlink-checker:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v2
      - name: run tests
        run: |
          code=0
          cd tests/
          dirs=$(ls)
          for dr in $dirs; do
            cd $dr;
            find . -name *".resource" | grep .
            if [[ $? != "0" ]]; then
              echo "No resource file under $dr!"
              code=1
            fi
            find . -name *".robot" | grep .
            if [[ $? != "0" ]]; then
              echo "No robot files under $dr!"
              code=1
            fi
            common_info=$(stat common)
            if [[ $common_info != *"common -> ../../common/"* ]]; then
              echo "something is wrong with the common symlink!"
              code=1
            fi
            cd ..
          done
          exit $code
